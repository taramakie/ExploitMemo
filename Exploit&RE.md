# Exploit&Reversing
[Nightmare](https://github.com/guyinatuxedo/nightmare)を解きながらExploitに役立ちそうなことを自分用にメモ
## コマンド
### file
ビット数、エンディアン、アーキテクチャ、ライブラリのリンクは動的か静的か、シンボルの有無を確認する
### pwn checksec
アーキテクチャやRELRO、Stack Canary、NX、PIEといったエクスプロイトへの緩和策の有無を確認できる

## Python
### 生のバイナリをプリントする
sys.stdout.bufferのwriteを使うとPython 3系で生のバイナリをプリントできる。
```
import sys; sys.stdout.buffer.write(b"\xde\xad\xbe\xef")
```

## 危険な関数
### gets
- bofの可能性がある
- NewLineやEOFが入力されるまで入力値を受け取る
- メモリへの読み込み時に改行文字はNULL文字になる

## エラーとその回避策
### System関数のアラインメントのエラー
system関数内の以下のようなところでSIGSEGVエラーが出る時がある。原因はアラインメントの問題で16バイトにそろえてやる必要がある。
```
0x7fbc2ff54e3c <do_system+364>  movaps XMMWORD PTR [rsp+0x50], xmm0
```
なんとかスタックのバイトを8バイトずらす必要がある。最初からやっているとNightmareでは[Warmup](https://guyinatuxedo.github.io/05-bof_callfunction/csaw16_warmup/index.html)でこの問題にぶつかるはず。ジャンプ先のアドレスを0x40060eにして「`push rbp`」を飛ばすことで回避した。[このブログ記事](https://smallkirby.hatenablog.com/entry/2019/08/23/223507)のように、retに飛ぶROPを目的とするジャンプ先の前に入れても解決できるはず。